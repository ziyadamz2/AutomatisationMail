import requests
import datetime
import csv
import os
import base64
import smtplib
from email.mime.multipart import MIMEMultipart
from email.mime.base import MIMEBase
from email.mime.text import MIMEText
from email.utils import COMMASPACE
from email import encoders

def cletoken():
     # Encodez les informations d'identification de l'application en Base64
    consumer_key = 'K7A0YOXKaSnmjSL4hgFFiYHjus4a'
    consumer_secret = 'M13XtgmrO4Vy_MD4anVOUokZoQ0a'
    auth_string = f"{consumer_key}:{consumer_secret}"
    base64_bytes = base64.b64encode(auth_string.encode('ascii'))
    base64_string = base64_bytes.decode('ascii')
    token_url = 'https://api.insee.fr/token'
    
    payload = {'grant_type': 'client_credentials'}
    headers = {'Authorization': f'Basic {base64_string}'}
    response = requests.post(token_url, data=payload, headers=headers)    
    # Si la requête a réussi (code de statut HTTP 200), affichez le jeton d'authentification
    if response.status_code != 200:
        print(f"La requête a échoué avec le code de statut HTTP {response.status_code}")
    else:
        data = response.json()
        access_token = data['access_token']
    return access_token, consumer_key, consumer_secret

def remove_old_token(oldtoken):
       # Encodez les informations d'identification de l'application en Base64
    consumer_key = oldtoken[1]
    consumer_secret = oldtoken[2]
    auth_string = f"{consumer_key}:{consumer_secret}"
    base64_bytes = base64.b64encode(auth_string.encode('ascii'))
    base64_string = base64_bytes.decode('ascii')
    
    # Endpoint de l'API pour révoquer le jeton d'authentification
    revoke_url = 'https://api.insee.fr/revoke'
    
    # Jeton d'authentification à révoquer

    # Corps de la requête POST
    payload = {'token': oldtoken[0]}
    
    # En-têtes de la requête POST
    headers = {'Authorization': f'Basic {base64_string}'}
    
    # Effectuez la requête POST avec requests
    response = requests.post(revoke_url, data=payload, headers=headers)
    
    # Si la requête a réussi (code de statut HTTP 200), affichez le message de réussite
    if response.status_code != 200:
        print(f"La requête a échoué avec le code de statut HTTP {response.status_code}")
    return cletoken()

def get_key(val,my_dict):
    for key, value in my_dict.items():
         if val == value:
             return key

def utilisation_donnees(TOKEN):
    date = datetime.datetime.now()
    tim=date.strftime("%Y-%m-%d")
    headers={"Authorization":"Bearer "+TOKEN}
    url="https://api.insee.fr/entreprises/sirene/V3/siren?q=dateCreationUniteLegale%3A"+str(tim)+"&champs=siren%2CactivitePrincipaleUniteLegale%2CprenomUsuelUniteLegale%2CnomUniteLegale"
    response=requests.get(url,headers=headers)
    data = response.json()
    nb=data['header']['total']
    url2="https://api.insee.fr/entreprises/sirene/V3/siren?q=dateCreationUniteLegale%3A"+str(tim)+"&champs=siren%2CactivitePrincipaleUniteLegale%2CprenomUsuelUniteLegale%2CnomUniteLegale%2CnicSiegeUniteLegale&masquerValeursNulles=true&nombre="+str(nb)
    response=requests.get(url2,headers=headers)
    data = response.json()
    return data



def traitement_données(test,TOKEN):
    cles =[]
    unité={'Culture et production animale, chasse et services annexes': '01', 'Cultures non permanentes': '01.1', "Culture de céréales (à l'exception du riz), de légumineuses et de graines oléagineuses": '01.11Z', 'Culture du riz': '01.12Z', 'Culture de légumes, de melons, de racines et de tubercules': '01.13Z', 'Culture de la canne à sucre': '01.14Z', 'Culture du tabac': '01.15Z', 'Culture de plantes à fibres': '01.16Z', 'Autres cultures non permanentes': '01.19Z', 'Cultures permanentes': '01.2', 'Culture de la vigne': '01.21Z', 'Culture de fruits tropicaux et subtropicaux': '01.22Z', "Culture d'agrumes": '01.23Z', 'Culture de fruits à pépins et à noyau': '01.24Z', "Culture d'autres fruits d'arbres ou d'arbustes et de fruits à coque": '01.25Z', 'Culture de fruits oléagineux': '01.26Z', 'Culture de plantes à boissons': '01.27Z', 'Culture de plantes à épices, aromatiques, médicinales et pharmaceutiques': '01.28Z', 'Autres cultures permanentes': '01.29Z', 'Reproduction de plantes': '01.30Z', 'Production animale': '01.4', 'Élevage de vaches laitières': '01.41Z', "Élevage d'autres bovins et de buffles": '01.42Z', "Élevage de chevaux et d'autres équidés": '01.43Z', "Élevage de chameaux et d'autres camélidés": '01.44Z', "Élevage d'ovins et de caprins": '01.45Z', 'Élevage de porcins': '01.46Z', 'Élevage de volailles': '01.47Z', "Élevage d'autres animaux": '01.49Z', 'Culture et élevage associés': '01.50Z', "Activités de soutien à l'agriculture et traitement primaire des récoltes": '01.6', 'Activités de soutien aux cultures': '01.61Z', 'Activités de soutien à la production animale': '01.62Z', 'Traitement primaire des récoltes': '01.63Z', 'Traitement des semences': '01.64Z', 'Chasse, piégeage et services annexes': '01.70Z', 'Sylviculture et exploitation forestière': '02', 'Sylviculture et autres activités forestières': '02.10Z', 'Exploitation forestière': '02.20Z', "Récolte de produits forestiers non ligneux poussant à l'état sauvage": '02.30Z', "Services de soutien à l'exploitation forestière": '02.40Z', 'Pêche et aquaculture': '03', 'Pêche': '03.1', 'Pêche en mer': '03.11Z', 'Pêche en eau douce': '03.12Z', 'Aquaculture': '03.2', 'Aquaculture en mer': '03.21Z', 'Aquaculture en eau douce': '03.22Z', 'Extraction de houille et de lignite': '05', 'Extraction de houille': '05.10Z', 'Extraction de lignite': '05.20Z', "Extraction d'hydrocarbures": '06', 'Extraction de pétrole brut': '06.10Z', 'Extraction de gaz naturel': '06.20Z', 'Extraction de minerais métalliques': '07', 'Extraction de minerais de fer': '07.10Z', 'Extraction de minerais de métaux non ferreux': '07.2', "Extraction de minerais d'uranium et de thorium": '07.21Z', "Extraction d'autres minerais de métaux non ferreux": '07.29Z', 'Autres industries extractives': '08', "Extraction de pierres, de sables et d'argiles": '08.1', "Extraction de pierres ornementales et de construction, de calcaire industriel, de gypse, de craie et d'ardoise": '08.11Z', 'Exploitation de gravières et sablières, extraction d’argiles et de kaolin': '08.12Z', 'Activités extractives n.c.a.': '08.9', "Extraction des minéraux chimiques et d'engrais minéraux ": '08.91Z', 'Extraction de tourbe': '08.92Z', 'Production de sel ': '08.93Z', 'Autres activités extractives n.c.a.': '08.99Z', 'Services de soutien aux industries extractives': '09', "Activités de soutien à l'extraction d'hydrocarbures": '09.10Z', 'Activités de soutien aux autres industries extractives': '09.9', 'Activités de soutien aux autres industries extractives ': '09.90Z', 'Industries alimentaires': '10', 'Transformation et conservation de la viande et préparation de produits à base de viande': '10.1', 'Transformation et conservation de la viande de boucherie': '10.11Z', 'Transformation et conservation de la viande de volaille': '10.12Z', 'Préparation de produits à base de viande': '10.13', 'Préparation industrielle de produits à base de viande': '10.13A', 'Charcuterie': '10.13B', 'Transformation et conservation de poisson, de crustacés et de mollusques': '10.20Z', 'Transformation et conservation de fruits et légumes': '10.3', 'Transformation et conservation de pommes de terre': '10.31Z', 'Préparation de jus de fruits et légumes': '10.32Z', 'Autre transformation et conservation de fruits et légumes': '10.39', 'Autre transformation et conservation de légumes': '10.39A', 'Transformation et conservation de fruits': '10.39B', 'Fabrication d’huiles et graisses végétales et animales': '10.4', "Fabrication d'huiles et graisses": '10.41', "Fabrication d'huiles et graisses brutes": '10.41A', "Fabrication d'huiles et graisses raffinées": '10.41B', 'Fabrication de margarine et graisses comestibles similaires': '10.42Z', 'Fabrication de produits laitiers': '10.5', 'Exploitation de laiteries et fabrication de fromage': '10.51', 'Fabrication de lait liquide et de produits frais': '10.51A', 'Fabrication de beurre': '10.51B', 'Fabrication de fromage': '10.51C', "Fabrication d'autres produits laitiers": '10.51D', 'Fabrication de glaces et sorbets': '10.52Z', 'Travail des grains ; fabrication de produits amylacés': '10.6', 'Travail des grains': '10.61', 'Meunerie': '10.61A', 'Autres activités du travail des grains': '10.61B', 'Fabrication de produits amylacés': '10.62Z', 'Fabrication de produits de boulangerie-pâtisserie et de pâtes alimentaires': '10.7', 'Fabrication de pain et de pâtisserie fraîche': '10.71', 'Fabrication industrielle de pain et de pâtisserie fraîche': '10.71A', 'Cuisson de produits de boulangerie': '10.71B', 'Boulangerie et boulangerie-pâtisserie': '10.71C', 'Pâtisserie': '10.71D', 'Fabrication de biscuits, biscottes et pâtisseries de conservation': '10.72Z', 'Fabrication de pâtes alimentaires': '10.73Z', "Fabrication d'autres produits alimentaires": '10.8', 'Fabrication de sucre': '10.81Z', 'Fabrication de cacao, chocolat et de produits de confiserie': '10.82Z', 'Transformation du thé et du café': '10.83Z', 'Fabrication de condiments et assaisonnements': '10.84Z', 'Fabrication de plats préparés': '10.85Z', "Fabrication d'aliments homogénéisés et diététiques": '10.86Z', "Fabrication d'autres produits alimentaires n.c.a.": '10.89Z', "Fabrication d'aliments pour animaux": '10.9', "Fabrication d'aliments pour animaux de ferme": '10.91Z', "Fabrication d'aliments pour animaux de compagnie": '10.92Z', 'Fabrication de boissons': '11.0', 'Production de boissons alcooliques distillées': '11.01Z', 'Production de vin (de raisin)': '11.02', 'Fabrication de vins effervescents': '11.02A', 'Vinification': '11.02B', 'Fabrication de cidre et de vins de fruits  ': '11.03', 'Fabrication de cidre et de vins de fruits ': '11.03Z', "Production d'autres boissons fermentées non distillées": '11.04Z', 'Fabrication de bière': '11.05Z', 'Fabrication de malt': '11.06Z', 'Industrie des eaux minérales et autres eaux embouteillées et des boissons rafraîchissantes': '11.07', 'Industrie des eaux de table': '11.07A', 'Production de boissons rafraîchissantes': '11.07B', 'Fabrication de produits à base de tabac': '12.00Z', 'Fabrication de textiles': '13', 'Préparation de fibres textiles et filature': '13.10Z', 'Tissage': '13.20Z', 'Ennoblissement textile': '13.30Z', "Fabrication d'autres textiles": '13.9', "Fabrication d'étoffes à mailles": '13.91Z', "Fabrication d'articles textiles, sauf habillement": '13.92Z', 'Fabrication de tapis et moquettes': '13.93Z', 'Fabrication de ficelles, cordes et filets': '13.94Z', 'Fabrication de non-tissés, sauf habillement': '13.95Z', "Fabrication d'autres textiles techniques et industriels": '13.96Z', "Fabrication d'autres textiles n.c.a.": '13.99Z', "Industrie de l'habillement": '14', "Fabrication de vêtements, autres qu'en fourrure": '14.1', 'Fabrication de vêtements en cuir': '14.11Z', 'Fabrication de vêtements de travail': '14.12Z', 'Fabrication de vêtements de dessus': '14.13Z', 'Fabrication de vêtements de dessous': '14.14Z', "Fabrication d'autres vêtements et accessoires": '14.19Z', "Fabrication d'articles en fourrure": '14.20Z', "Fabrication d'articles à mailles": '14.3', "Fabrication d'articles chaussants à mailles": '14.31Z', "Fabrication d'autres articles à mailles": '14.39Z', 'Industrie du cuir et de la chaussure': '15', "Apprêt et tannage des cuirs ; préparation et teinture des fourrures ; fabrication d'articles de voyage, de maroquinerie et de sellerie": '15.1', 'Apprêt et tannage des cuirs ; préparation et teinture des fourrures': '15.11Z', "Fabrication d'articles de voyage, de maroquinerie et de sellerie": '15.12Z', 'Fabrication de chaussures': '15.20Z', "Travail du bois et fabrication d'articles en bois et en liège, à l’exception des meubles ; fabrication d’articles en vannerie et sparterie": '16', 'Sciage et rabotage du bois': '16.10', 'Sciage et rabotage du bois, hors imprégnation': '16.10A', 'Imprégnation du bois': '16.10B', "Fabrication d'articles en bois, liège, vannerie et sparterie": '16.2', 'Fabrication de placage et de panneaux de bois': '16.21Z', 'Fabrication de parquets assemblés': '16.22Z', "Fabrication de charpentes et d'autres menuiseries": '16.23Z', "Fabrication d'emballages en bois": '16.24Z', "Fabrication d'objets divers en bois ; fabrication d'objets en liège, vannerie et sparterie": '16.29Z', 'Industrie du papier et du carton': '17', 'Fabrication de pâte à papier, de papier et de carton': '17.1', 'Fabrication de pâte à papier': '17.11Z', 'Fabrication de papier et de carton': '17.12Z', "Fabrication d'articles en papier ou en carton": '17.2', "Fabrication de papier et carton ondulés et d'emballages en papier ou en carton": '17.21', 'Fabrication de carton ondulé': '17.21A', 'Fabrication de cartonnages ': '17.21B', "Fabrication d'emballages en papier": '17.21C', "Fabrication d'articles en papier à usage sanitaire ou domestique": '17.22Z', "Fabrication d'articles de papeterie": '17.23Z', 'Fabrication de papiers peints': '17.24Z', "Fabrication d'autres articles en papier ou en carton": '17.29Z', "Imprimerie et reproduction d'enregistrements": '18', 'Imprimerie et services annexes': '18.1', 'Imprimerie de journaux': '18.11Z', 'Autre imprimerie (labeur)': '18.12Z', 'Activités de pré-presse ': '18.13Z', 'Reliure et activités connexes': '18.14Z', "Reproduction d'enregistrements": '18.20Z', 'Cokéfaction et raffinage': '19', 'Cokéfaction': '19.10Z', 'Raffinage du pétrole': '19.20Z', 'Industrie chimique': '20', "Fabrication de produits chimiques de base, de produits azotés et d'engrais, de matières plastiques de base et de caoutchouc synthétique": '20.1', 'Fabrication de gaz industriels': '20.11Z', 'Fabrication de colorants et de pigments': '20.12Z', "Fabrication d'autres produits chimiques inorganiques de base": '20.13', 'Enrichissement et  retraitement de matières nucléaires': '20.13A', "Fabrication d'autres produits chimiques inorganiques de base n.c.a.": '20.13B', "Fabrication d'autres produits chimiques organiques de base": '20.14Z', "Fabrication de produits azotés et d'engrais": '20.15Z', 'Fabrication de matières plastiques de base': '20.16Z', 'Fabrication de caoutchouc synthétique': '20.17Z', 'Fabrication de pesticides et d’autres produits agrochimiques ': '20.2', 'Fabrication de pesticides et d’autres produits agrochimiques': '20.20Z', 'Fabrication de peintures, vernis, encres et mastics': '20.30Z', "Fabrication de savons, de produits d'entretien et de parfums": '20.4', "Fabrication de savons, détergents et produits d'entretien": '20.41Z', 'Fabrication de parfums et de produits pour la toilette': '20.42Z', "Fabrication d'autres produits chimiques": '20.5', 'Fabrication de produits explosifs': '20.51Z', 'Fabrication de colles': '20.52Z', "Fabrication d'huiles essentielles": '20.53Z', "Fabrication d'autres produits chimiques n.c.a.": '20.59Z', 'Fabrication de fibres artificielles ou synthétiques': '20.60Z', 'Industrie pharmaceutique': '21', 'Fabrication de produits pharmaceutiques de base': '21.10Z', 'Fabrication de préparations pharmaceutiques': '21.20Z', 'Fabrication de produits en caoutchouc et en plastique': '22', 'Fabrication de produits en caoutchouc': '22.1', 'Fabrication et rechapage de pneumatiques': '22.11Z', "Fabrication d'autres articles en caoutchouc": '22.19Z', 'Fabrication  de produits en plastique': '22.2', 'Fabrication de plaques, feuilles, tubes et profilés en matières plastiques': '22.21Z', "Fabrication d'emballages en matières plastiques": '22.22Z', "Fabrication d'éléments en matières plastiques pour la construction": '22.23Z', "Fabrication d'autres articles en matières plastiques": '22.29', 'Fabrication de pièces techniques à base de matières plastiques': '22.29A', 'Fabrication de produits de consommation courante en matières plastiques': '22.29B', "Fabrication d'autres produits minéraux non métalliques": '23', "Fabrication de verre et d'articles en verre": '23.1', 'Fabrication de verre plat': '23.11Z', 'Façonnage et transformation du verre plat': '23.12Z', 'Fabrication de verre creux': '23.13Z', 'Fabrication de fibres de verre': '23.14Z', "Fabrication et façonnage d'autres articles en verre, y compris verre technique": '23.19Z', 'Fabrication de produits réfractaires': '23.20Z', 'Fabrication de matériaux de construction en terre cuite': '23.3', 'Fabrication de carreaux en céramique': '23.31Z', 'Fabrication de briques, tuiles et produits de construction, en terre cuite': '23.32Z', "Fabrication d'autres produits en céramique et en porcelaine ": '23.4', "Fabrication d'articles céramiques à usage domestique ou ornemental": '23.41Z', "Fabrication d'appareils sanitaires en céramique": '23.42Z', "Fabrication d'isolateurs et pièces isolantes en céramique": '23.43Z', "Fabrication d'autres produits céramiques à usage technique": '23.44Z', "Fabrication d'autres produits céramiques ": '23.49', "Fabrication d'autres produits céramiques": '23.49Z', 'Fabrication de ciment, chaux et plâtre': '23.5', 'Fabrication de ciment': '23.51Z', 'Fabrication de chaux et plâtre': '23.52Z', "Fabrication d'ouvrages en béton, en ciment ou en plâtre": '23.6', "Fabrication d'éléments en béton pour la construction": '23.61Z', "Fabrication d'éléments en plâtre pour la construction": '23.62Z', "Fabrication de béton prêt à l'emploi": '23.63Z', 'Fabrication de mortiers et bétons secs': '23.64Z', "Fabrication d'ouvrages en fibre-ciment": '23.65Z', "Fabrication d'autres ouvrages en béton, en ciment ou en plâtre": '23.69Z', 'Taille, façonnage et finissage de pierres ': '23.7', 'Taille, façonnage et finissage de pierres': '23.70Z', 'Fabrication de produits abrasifs et de produits minéraux non métalliques n.c.a.': '23.9', 'Fabrication de produits abrasifs': '23.91Z', "Fabrication d'autres produits minéraux non métalliques n.c.a.": '23.99Z', 'Métallurgie': '24', 'Sidérurgie': '24.10Z', 'Fabrication de tubes, tuyaux, profilés creux et accessoires correspondants en acier ': '24.20Z', "Fabrication d'autres produits de première transformation de l'acier": '24.3', 'Étirage à froid de barres': '24.31Z', 'Laminage à froid de feuillards': '24.32Z', 'Profilage à froid par formage ou pliage': '24.33Z', 'Tréfilage à froid': '24.34Z', "Production de métaux précieux et d'autres métaux non ferreux": '24.4', 'Production de métaux précieux': '24.41Z', "Métallurgie de l'aluminium": '24.42Z', "Métallurgie du plomb, du zinc ou de l'étain": '24.43Z', 'Métallurgie du cuivre': '24.44Z', 'Métallurgie des autres métaux non ferreux': '24.45Z', 'Élaboration et transformation de matières nucléaires': '24.46Z', 'Fonderie': '24.5', 'Fonderie de fonte': '24.51Z', "Fonderie d'acier": '24.52Z', 'Fonderie de métaux légers': '24.53Z', "Fonderie d'autres métaux non ferreux": '24.54Z', 'Fabrication de produits métalliques, à l’exception des machines et des équipements': '25', "Fabrication d'éléments en métal pour la construction": '25.1', 'Fabrication de structures métalliques et de parties de structures': '25.11Z', 'Fabrication de portes et fenêtres en métal': '25.12Z', 'Fabrication de réservoirs, citernes et conteneurs métalliques': '25.2', 'Fabrication de radiateurs et de chaudières pour le chauffage central': '25.21Z', "Fabrication d'autres réservoirs, citernes et conteneurs métalliques": '25.29Z', "Fabrication de générateurs de vapeur, à l'exception des chaudières pour le chauffage central": '25.30Z', "Fabrication d'armes et de munitions": '25.40Z', 'Forge, emboutissage, estampage ; métallurgie des poudres': '25.50', 'Forge, estampage, matriçage ; métallurgie des poudres': '25.50A', 'Découpage, emboutissage': '25.50B', 'Traitement et revêtement des métaux ; usinage': '25.6', 'Traitement et revêtement des métaux': '25.61Z', 'Usinage': '25.62', 'Décolletage': '25.62A', 'Mécanique industrielle': '25.62B', "Fabrication de coutellerie, d'outillage et de quincaillerie": '25.7', 'Fabrication de coutellerie': '25.71Z', 'Fabrication de serrures et de ferrures': '25.72Z', "Fabrication d'outillage": '25.73', 'Fabrication de moules et modèles': '25.73A', "Fabrication d'autres outillages": '25.73B', "Fabrication d'autres ouvrages en métaux": '25.9', 'Fabrication de fûts et emballages métalliques similaires': '25.91Z', "Fabrication d'emballages métalliques légers": '25.92Z', "Fabrication d'articles en fils métalliques, de chaînes et de ressorts": '25.93Z', 'Fabrication de vis et de boulons': '25.94Z', "Fabrication d'autres produits métalliques n.c.a.": '25.99', "Fabrication d'articles métalliques ménagers": '25.99A', "Fabrication d'autres articles métalliques": '25.99B', 'Fabrication de produits informatiques, électroniques et optiques': '26', 'Fabrication de composants et cartes électroniques': '26.1', 'Fabrication de composants électroniques': '26.11Z', 'Fabrication de cartes électroniques assemblées': '26.12Z', "Fabrication d'ordinateurs et d'équipements périphériques": '26.20Z', "Fabrication d'équipements de communication": '26.3', "Fabrication d'équipements de communication ": '26.30Z', 'Fabrication de produits électroniques grand public': '26.40Z', "Fabrication d'instruments et d'appareils de mesure, d'essai et de navigation ; horlogerie": '26.5', "Fabrication d'instruments et d'appareils de mesure, d'essai et de navigation": '26.51', "Fabrication d'équipements d'aide à la navigation": '26.51A', "Fabrication d'instrumentation scientifique et technique": '26.51B', 'Horlogerie': '26.52Z', "Fabrication d'équipements d'irradiation médicale, d'équipements électromédicaux et électrothérapeutiques": '26.6', "Fabrication d'équipements d'irradiation médicale, d'équipements électromédicaux et électrothérapeutiques ": '26.60Z', 'Fabrication de matériels optique et photographique': '26.70Z', 'Fabrication de supports magnétiques et optiques': '26.80Z', "Fabrication d'équipements électriques": '27', 'Fabrication de moteurs, génératrices et transformateurs électriques et de matériel de distribution et de commande électrique': '27.1', 'Fabrication de moteurs, génératrices et transformateurs électriques': '27.11Z', 'Fabrication de matériel de distribution et de commande électrique': '27.12Z', "Fabrication de piles et d'accumulateurs électriques": '27.20Z', "Fabrication de fils et câbles et de matériel d'installation électrique": '27.3', 'Fabrication de câbles de fibres optiques': '27.31Z', "Fabrication d'autres fils et câbles électroniques ou électriques": '27.32Z', "Fabrication de matériel d'installation électrique": '27.33Z', "Fabrication d'appareils d'éclairage électrique": '27.40Z', "Fabrication d'appareils ménagers": '27.5', "Fabrication d'appareils électroménagers": '27.51Z', "Fabrication d'appareils ménagers non électriques": '27.52Z', "Fabrication d'autres matériels électriques": '27.90Z', 'Fabrication de machines et équipements n.c.a.': '28', "Fabrication de machines d'usage général": '28.1', "Fabrication de moteurs et turbines, à l'exception des moteurs d’avions et de véhicules": '28.11Z', "Fabrication d'équipements hydrauliques et pneumatiques": '28.12Z', "Fabrication d'autres pompes et compresseurs": '28.13Z', "Fabrication d'autres articles de robinetterie": '28.14Z', "Fabrication d'engrenages et d'organes mécaniques de transmission": '28.15Z', "Fabrication d'autres machines d'usage général": '28.29B', 'Fabrication de fours et brûleurs': '28.21Z', 'Fabrication de matériel de levage et de manutention': '28.22Z', "Fabrication de machines et d'équipements de bureau (à l'exception des ordinateurs et équipements périphériques)": '28.23Z', "Fabrication d'outillage portatif à moteur incorporé": '28.24Z', "Fabrication d'équipements aérauliques et frigorifiques industriels": '28.25Z', "Fabrication de machines diverses d'usage général": '28.29', "Fabrication d'équipements d'emballage, de conditionnement et de pesage ": '28.29A', 'Fabrication de machines agricoles et forestières': '28.30Z', 'Fabrication de machines de formage des métaux et de machines-outils': '28.4', 'Fabrication de machines de formage des métaux': '28.41', 'Fabrication de machines-outils pour le travail des métaux': '28.41Z', "Fabrication d'autres machines-outils ": '28.49Z', "Fabrication d'autres machines d'usage spécifique": '28.9', 'Fabrication de machines pour la métallurgie': '28.91Z', "Fabrication de machines pour l'extraction ou la construction": '28.92Z', "Fabrication de machines pour l'industrie agro-alimentaire": '28.93Z', 'Fabrication de machines pour les industries textiles': '28.94Z', 'Fabrication de machines pour les industries du papier et du carton': '28.95Z', 'Fabrication de machines pour le travail du caoutchouc ou des plastiques': '28.96Z', "Fabrication d'autres machines d'usage spécifique n.c.a.": '28.99', "Fabrication de machines d'imprimerie": '28.99A', "Fabrication d'autres machines spécialisées": '28.99B', 'Industrie automobile': '29', 'Construction de véhicules automobiles': '29.10Z', 'Fabrication de carrosseries et remorques': '29.20Z', "Fabrication d'équipements automobiles": '29.3', "Fabrication d'équipements électriques et électroniques automobiles": '29.31Z', "Fabrication d'autres équipements automobiles": '29.32Z', "Fabrication d'autres matériels de transport": '30', 'Construction navale': '30.1', 'Construction de navires et de structures flottantes': '30.11Z', 'Construction de bateaux de plaisance': '30.12Z', "Construction de locomotives et d'autre matériel ferroviaire roulant": '30.2', "Construction de locomotives et d'autre matériel ferroviaire roulant ": '30.20Z', 'Construction aéronautique et spatiale ': '30.30Z', 'Construction de véhicules militaires de combat': '30.4', 'Construction de véhicules militaires de combat ': '30.40Z', 'Fabrication de matériels de transport n.c.a.': '30.9', 'Fabrication de motocycles': '30.91Z', 'Fabrication de bicyclettes et de véhicules pour invalides': '30.92Z', 'Fabrication d’autres équipements de transport n.c.a.': '30.99Z', 'Fabrication de meubles': '31.0', 'Fabrication de meubles de bureau et de magasin': '31.01Z', 'Fabrication de meubles de cuisine ': '31.02Z', 'Fabrication de matelas': '31.03Z', "Fabrication d'autres meubles": '31.09', "Fabrication de sièges d'ameublement d'intérieur": '31.09A', 'Fabrication d’autres meubles et industries connexes de l’ameublement': '31.09B', 'Autres industries manufacturières': '32', 'Fabrication d’articles de joaillerie, bijouterie et articles similaires': '32.1', 'Frappe de monnaie': '32.11Z', 'Fabrication d’articles de joaillerie et bijouterie': '32.12Z', 'Fabrication d’articles de bijouterie fantaisie et articles similaires': '32.13Z', "Fabrication d'instruments de musique": '32.20Z', "Fabrication d'articles de sport": '32.30Z', 'Fabrication de jeux et jouets': '32.40Z', "Fabrication d'instruments et de fournitures à usage médical et dentaire": '32.5', "Fabrication d'instruments et de fournitures à usage médical et dentaire ": '32.50', 'Fabrication de matériel médico-chirurgical et dentaire': '32.50A', 'Fabrication de lunettes': '32.50B', 'Activités manufacturières n.c.a.': '32.9', 'Fabrication d’articles de brosserie': '32.91Z', 'Autres activités manufacturières n.c.a. ': '32.99Z', "Réparation et installation de machines et d'équipements ": '33', "Réparation d'ouvrages en métaux, de machines et d'équipements": '33.1', "Réparation d'ouvrages en métaux": '33.11Z', 'Réparation de machines et équipements mécaniques': '33.12Z', 'Réparation de matériels électroniques et optiques': '33.13Z', "Réparation d'équipements électriques": '33.14Z', 'Réparation et maintenance navale': '33.15Z', "Réparation et maintenance d'aéronefs et d'engins spatiaux ": '33.16Z', "Réparation et maintenance d'autres équipements de transport": '33.17Z', "Réparation d'autres équipements": '33.19Z', "Installation de machines et d'équipements industriels": '33.20', 'Installation de structures métalliques, chaudronnées et de tuyauterie': '33.20A', 'Installation de machines et équipements mécaniques': '33.20B', "Conception d'ensemble et assemblage sur site industriel d'équipements de contrôle des processus industriels ": '33.20C', "Installation d'équipements électriques, de matériels électroniques et optiques ou d'autres matériels": '33.20D', "Production et distribution d'électricité, de gaz, de vapeur et d'air conditionné": '35', "Production, transport et distribution d'électricité": '35.1', "Production d'électricité": '35.11Z', "Transport d'électricité": '35.12Z', "Distribution d'électricité": '35.13Z', "Commerce d'électricité": '35.14Z', 'Production et distribution de combustibles gazeux': '35.2', 'Production de combustibles gazeux': '35.21Z', 'Distribution de combustibles gazeux par conduites': '35.22Z', 'Commerce de combustibles gazeux par conduites': '35.23Z', "Production et distribution de vapeur et d'air conditionné": '35.3', "Production et distribution de vapeur et d'air conditionné ": '35.30Z', "Captage, traitement et distribution d'eau ": '36', "Captage, traitement et distribution d'eau": '36.00Z', 'Collecte et traitement des eaux usées': '37.00Z', 'Collecte, traitement et élimination des déchets ; récupération': '38', 'Collecte des déchets': '38.1', 'Collecte des déchets non dangereux': '38.11Z', 'Collecte des déchets dangereux': '38.12Z', 'Traitement et élimination des déchets': '38.2', 'Traitement et élimination des déchets non dangereux': '38.21Z', 'Traitement et élimination des déchets dangereux': '38.22Z', 'Récupération': '38.3', "Démantèlement d'épaves": '38.31Z', 'Récupération de déchets triés': '38.32Z', 'Dépollution et autres services de gestion des déchets': '39.00Z', 'Construction de bâtiments ': '41', 'Promotion immobilière': '41.10', 'Promotion immobilière de logements': '41.10A', 'Promotion immobilière de bureaux': '41.10B', "Promotion immobilière d'autres bâtiments": '41.10C', 'Supports juridiques de programmes': '41.10D', 'Construction de bâtiments résidentiels et non résidentiels': '41.20', 'Construction de maisons individuelles': '41.20A', "Construction d'autres bâtiments": '41.20B', 'Génie civil': '42', 'Construction de routes et de voies ferrées ': '42.1', 'Construction de routes et autoroutes': '42.11Z', 'Construction de voies ferrées de surface et souterraines': '42.12Z', 'Construction de ponts et tunnels': '42.13', "Construction d'ouvrages d'art": '42.13A', 'Construction et entretien de tunnels': '42.13B', 'Construction de réseaux et de lignes': '42.2', 'Construction de réseaux pour fluides': '42.21Z', 'Construction de réseaux électriques et de télécommunications': '42.22Z', "Construction d'autres ouvrages de génie civil ": '42.9', "Construction d'ouvrages maritimes et fluviaux": '42.91Z', "Construction d'autres ouvrages de génie civil n.c.a.": '42.99Z', 'Travaux de construction spécialisés ': '43', 'Démolition et préparation des sites': '43.1', 'Travaux de démolition': '43.11Z', 'Travaux de préparation des sites': '43.12', 'Travaux de terrassement courants et travaux préparatoires': '43.12A', 'Travaux de terrassement spécialisés ou de grande masse': '43.12B', 'Forages et sondages': '43.13Z', "Travaux d'installation électrique, plomberie et autres travaux d'installation": '43.2', 'Installation électrique': '43.21', "Travaux d'installation électrique dans tous locaux": '43.21A', "Travaux d'installation électrique sur la voie publique": '43.21B', "Travaux de plomberie et installation de chauffage et de conditionnement d'air": '43.22', "Travaux d'installation d'eau et de gaz en tous locaux": '43.22A', "Travaux d'installation d'équipements thermiques et de climatisation": '43.22B', "Autres travaux d'installation": '43.29', "Travaux d'isolation": '43.29A', "Autres travaux d'installation n.c.a.": '43.29B', 'Travaux de finition': '43.3', 'Travaux de plâtrerie': '43.31Z', 'Travaux de menuiserie': '43.32', 'Travaux de menuiserie bois et PVC': '43.32A', 'Travaux de menuiserie métallique et serrurerie': '43.32B', 'Agencement de lieux de vente': '43.32C', 'Travaux de revêtement des sols et des murs': '43.33Z', 'Travaux de peinture et vitrerie': '43.34Z', 'Autres travaux de finition': '43.39Z', 'Autres travaux de construction spécialisés': '43.9', 'Travaux de couverture': '43.91', 'Travaux de charpente': '43.91A', 'Travaux de couverture par éléments': '43.91B', 'Autres travaux de construction spécialisés\xa0n.c.a.': '43.99', "Travaux d'étanchéification": '43.99A', 'Travaux de montage de structures métalliques': '43.99B', 'Travaux de maçonnerie générale et gros œuvre de bâtiment': '43.99C', 'Autres travaux spécialisés de construction': '43.99D', 'Location avec opérateur de matériel de construction': '43.99E', "Commerce et réparation d'automobiles et de motocycles": '45', 'Commerce de véhicules automobiles': '45.1', 'Commerce de voitures et de véhicules automobiles légers': '45.11Z', "Commerce d'autres véhicules automobiles": '45.19Z', 'Entretien et réparation de véhicules automobiles': '45.20', 'Entretien et réparation de véhicules automobiles légers': '45.20A', "Entretien et réparation d'autres véhicules automobiles": '45.20B', "Commerce d'équipements automobiles": '45.3', "Commerce de gros d'équipements automobiles": '45.31Z', "Commerce de détail d'équipements automobiles": '45.32Z', 'Commerce et réparation de motocycles': '45.40Z', 'Commerce de gros, à l’exception des automobiles et des motocycles': '46', 'Intermédiaires du commerce de gros': '46.1', 'Intermédiaires du commerce en matières premières agricoles, animaux vivants, matières premières textiles et produits semi-finis': '46.11Z', 'Intermédiaires du commerce en combustibles, métaux, minéraux et produits chimiques': '46.12', "Centrales d'achat de carburant": '46.12A', 'Autres intermédiaires du commerce en combustibles, métaux, minéraux et produits chimiques': '46.12B', 'Intermédiaires du commerce en bois et matériaux de construction': '46.13Z', 'Intermédiaires du commerce en machines, équipements industriels, navires et avions': '46.14Z', 'Intermédiaires du commerce en meubles, articles de ménage et quincaillerie': '46.15Z', 'Intermédiaires du commerce en textiles, habillement, fourrures, chaussures et articles en cuir': '46.16Z', 'Intermédiaires du commerce en denrées, boissons et tabac': '46.17', "Centrales d'achat alimentaires": '46.17A', 'Autres intermédiaires du commerce en denrées, boissons et tabac': '46.17B', "Intermédiaires spécialisés dans le commerce d'autres produits spécifiques": '46.18Z', 'Intermédiaires du commerce en produits divers': '46.19', "Centrales d'achat non alimentaires": '46.19A', 'Autres intermédiaires du commerce en produits divers': '46.19B', "Commerce de gros de produits agricoles bruts et d'animaux vivants": '46.2', "Commerce de gros de céréales, de tabac non manufacturé, de semences et d'aliments pour le bétail ": '46.21', "Commerce de gros (commerce interentreprises) de céréales, de tabac non manufacturé, de semences et d'aliments pour le bétail ": '46.21Z', 'Commerce de gros de fleurs et plantes': '46.22', 'Commerce de gros (commerce interentreprises) de fleurs et plantes': '46.22Z', "Commerce de gros d'animaux vivants": '46.23', "Commerce de gros (commerce interentreprises) d'animaux vivants": '46.23Z', 'Commerce de gros de cuirs et peaux': '46.24', 'Commerce de gros (commerce interentreprises) de cuirs et peaux': '46.24Z', 'Commerce de gros de produits alimentaires, de boissons et de tabac': '46.3', 'Commerce de gros de fruits et légumes': '46.31', 'Commerce de gros (commerce interentreprises) de fruits et légumes': '46.31Z', 'Commerce de gros de viandes et de produits à base de viande': '46.32', 'Commerce de gros (commerce interentreprises) de viandes de boucherie': '46.32A', 'Commerce de gros (commerce interentreprises) de produits à base de viande': '46.32B', 'Commerce de gros (commerce interentreprises) de volailles et gibier': '46.32C', 'Commerce de gros de produits laitiers, œufs, huiles et matières grasses comestibles': '46.33', 'Commerce de gros (commerce interentreprises) de produits laitiers, œufs, huiles et matières grasses comestibles': '46.33Z', 'Commerce de gros de boissons': '46.34', 'Commerce de gros (commerce interentreprises) de boissons': '46.34Z', 'Commerce de gros de produits à base de tabac': '46.35', 'Commerce de gros (commerce interentreprises) de produits à base de tabac': '46.35Z', 'Commerce de gros de sucre, chocolat et confiserie': '46.36', 'Commerce de gros (commerce interentreprises) de sucre, chocolat et confiserie': '46.36Z', 'Commerce de gros de café, thé, cacao et épices': '46.37', 'Commerce de gros (commerce interentreprises) de café, thé, cacao et épices': '46.37Z', "Commerce de gros d'autres produits alimentaires, y compris poissons, crustacés et mollusques": '46.38', 'Commerce de gros (commerce interentreprises) de poissons, crustacés et mollusques': '46.38A', 'Commerce de gros (commerce interentreprises) alimentaire spécialisé divers': '46.38B', 'Commerce de gros non spécialisé de denrées, boissons et tabac': '46.39', 'Commerce de gros (commerce interentreprises) de produits surgelés': '46.39A', 'Commerce de gros (commerce interentreprises) alimentaire non spécialisé': '46.39B', 'Commerce de gros de biens domestiques': '46.4', 'Commerce de gros de textiles': '46.41', 'Commerce de gros (commerce interentreprises) de textiles': '46.41Z', "Commerce de gros d'habillement et de chaussures": '46.42', "Commerce de gros (commerce interentreprises) d'habillement et de chaussures": '46.42Z', "Commerce de gros d'appareils électroménagers": '46.43', "Commerce de gros (commerce interentreprises) d'appareils électroménagers": '46.43Z', "Commerce de gros de vaisselle, verrerie et produits d'entretien": '46.44', "Commerce de gros (commerce interentreprises) de vaisselle, verrerie et produits d'entretien": '46.44Z', 'Commerce de gros de parfumerie et de produits de beauté': '46.45', 'Commerce de gros (commerce interentreprises) de parfumerie et de produits de beauté': '46.45Z', 'Commerce de gros de produits pharmaceutiques': '46.46', 'Commerce de gros (commerce interentreprises) de produits pharmaceutiques': '46.46Z', "Commerce de gros de meubles, de tapis et d'appareils d'éclairage ": '46.47', "Commerce de gros (commerce interentreprises) de meubles, de tapis et d'appareils d'éclairage ": '46.47Z', "Commerce de gros d'articles d'horlogerie et de bijouterie": '46.48', "Commerce de gros (commerce interentreprises) d'articles d'horlogerie et de bijouterie": '46.48Z', "Commerce de gros d'autres biens domestiques": '46.49', "Commerce de gros (commerce interentreprises) d'autres biens domestiques ": '46.49Z', "Commerce de gros d'équipements de l'information et de la communication ": '46.5', "Commerce de gros d'ordinateurs, d'équipements informatiques périphériques et de logiciels": '46.51', "Commerce de gros (commerce interentreprises) d'ordinateurs, d'équipements informatiques périphériques et de logiciels": '46.51Z', "Commerce de gros de composants et d'équipements électroniques et de télécommunication": '46.52', "Commerce de gros (commerce interentreprises) de composants et d'équipements électroniques et de télécommunication": '46.52Z', "Commerce de gros d'autres équipements industriels": '46.6', 'Commerce de gros de matériel agricole': '46.61', 'Commerce de gros (commerce interentreprises) de matériel agricole': '46.61Z', 'Commerce de gros de machines-outils': '46.62', 'Commerce de gros (commerce interentreprises) de machines-outils': '46.62Z', "Commerce de gros de machines pour l'extraction, la construction et le génie civil ": '46.63', "Commerce de gros (commerce interentreprises) de machines pour l'extraction, la construction et le génie civil ": '46.63Z', "Commerce de gros de machines pour l'industrie textile et l'habillement": '46.64', "Commerce de gros (commerce interentreprises) de machines pour l'industrie textile et l'habillement": '46.64Z', 'Commerce de gros de mobilier de bureau': '46.65', 'Commerce de gros (commerce interentreprises) de mobilier de bureau': '46.65Z', "Commerce de gros d'autres machines et équipements de bureau ": '46.66', "Commerce de gros (commerce interentreprises) d'autres machines et équipements de bureau ": '46.66Z', "Commerce de gros d'autres machines et équipements": '46.69', 'Commerce de gros (commerce interentreprises) de matériel électrique': '46.69A', 'Commerce de gros (commerce interentreprises) de fournitures et équipements industriels divers': '46.69B', 'Commerce de gros (commerce interentreprises) de fournitures et équipements divers pour le commerce et les services': '46.69C', 'Autres commerces de gros spécialisés': '46.7', 'Commerce de gros de combustibles et de produits annexes': '46.71', 'Commerce de gros (commerce interentreprises) de combustibles et de produits annexes': '46.71Z', 'Commerce de gros de minerais et métaux': '46.72', 'Commerce de gros (commerce interentreprises) de minerais et métaux': '46.72Z', "Commerce de gros de bois, de matériaux de construction et d'appareils sanitaires ": '46.73', 'Commerce de gros (commerce interentreprises) de bois et de matériaux de construction ': '46.73A', "Commerce de gros (commerce interentreprises) d'appareils sanitaires et de produits de décoration": '46.73B', 'Commerce de gros de quincaillerie et fournitures pour plomberie et chauffage': '46.74', 'Commerce de gros (commerce interentreprises) de quincaillerie': '46.74A', 'Commerce de gros (commerce interentreprises) de fournitures pour la plomberie et le chauffage': '46.74B', 'Commerce de gros de produits chimiques': '46.75', 'Commerce de gros (commerce interentreprises) de produits chimiques': '46.75Z', "Commerce de gros d'autres produits intermédiaires": '46.76', "Commerce de gros (commerce interentreprises) d'autres produits intermédiaires": '46.76Z', 'Commerce de gros de déchets et débris': '46.77', 'Commerce de gros (commerce interentreprises) de déchets et débris': '46.77Z', 'Commerce de gros non spécialisé': '46.90', 'Commerce de gros (commerce interentreprises) non spécialisé': '46.90Z', 'Commerce de détail, à l’exception des automobiles et des motocycles': '47', 'Commerce de détail en magasin non spécialisé': '47.1', 'Commerce de détail en magasin non spécialisé à prédominance alimentaire': '47.11', 'Commerce de détail de produits surgelés': '47.11A', "Commerce d'alimentation générale": '47.11B', 'Supérettes': '47.11C', 'Supermarchés': '47.11D', 'Magasins multi-commerces': '47.11E', 'Hypermarchés': '47.11F', 'Autre commerce de détail en magasin non spécialisé': '47.19', 'Grands magasins': '47.19A', 'Autres commerces de détail en magasin non spécialisé': '47.19B', 'Commerce de détail alimentaire en magasin spécialisé': '47.2', 'Commerce de détail de fruits et légumes en magasin spécialisé': '47.21Z', 'Commerce de détail de viandes et de produits à base de viande en magasin spécialisé': '47.22Z', 'Commerce de détail de poissons, crustacés et mollusques en magasin spécialisé': '47.23Z', 'Commerce de détail de pain, pâtisserie et confiserie en magasin spécialisé': '47.24Z', 'Commerce de détail de boissons en magasin spécialisé': '47.25Z', 'Commerce de détail de produits à base de tabac en magasin spécialisé': '47.26Z', 'Autres commerces de détail alimentaires en magasin spécialisé ': '47.29Z', 'Commerce de détail de carburants en magasin spécialisé': '47.30Z', "Commerce de détail d'équipements de l'information et de la communication en magasin spécialisé": '47.4', "Commerce de détail d'ordinateurs, d'unités périphériques et de logiciels en magasin spécialisé": '47.41Z', 'Commerce de détail de matériels de télécommunication en magasin spécialisé': '47.42Z', 'Commerce de détail de matériels audio/vidéo en magasin spécialisé': '47.43', 'Commerce de détail de matériels audio et vidéo en magasin spécialisé': '47.43Z', "Commerce de détail d'autres équipements du foyer en magasin spécialisé": '47.5', 'Commerce de détail de textiles en magasin spécialisé': '47.51Z', 'Commerce de détail de quincaillerie, peintures et verres en magasin spécialisé': '47.52', 'Commerce de détail de quincaillerie, peintures et verres en petites surfaces (moins de 400 m2)': '47.52A', 'Commerce de détail de quincaillerie, peintures et verres en grandes surfaces (400 m2et plus)': '47.52B', 'Commerce de détail de tapis, moquettes et revêtements de murs et de sols en magasin spécialisé': '47.53Z', "Commerce de détail d'appareils électroménagers en magasin spécialisé": '47.54Z', "Commerce de détail de meubles, appareils d'éclairage et autres articles de ménage en magasin spécialisé": '47.59', 'Commerce de détail de meubles': '47.59A', "Commerce de détail d'autres équipements du foyer": '47.59B', 'Commerce de détail de biens culturels et de loisirs en magasin spécialisé': '47.6', 'Commerce de détail de livres en magasin spécialisé': '47.61Z', 'Commerce de détail de journaux et papeterie en magasin spécialisé': '47.62Z', "Commerce de détail d'enregistrements musicaux et vidéo en magasin spécialisé": '47.63Z', "Commerce de détail d'articles de sport en magasin spécialisé": '47.64Z', 'Commerce de détail de jeux et jouets en magasin spécialisé': '47.65Z', 'Autres commerces de détail en magasin spécialisé': '47.7', "Commerce de détail d'habillement en magasin spécialisé": '47.71Z', "Commerce de détail de chaussures et d'articles en cuir en magasin spécialisé": '47.72', 'Commerce de détail de la chaussure': '47.72A', "Commerce de détail de maroquinerie et d'articles de voyage": '47.72B', 'Commerce de détail de produits pharmaceutiques en magasin spécialisé': '47.73Z', "Commerce de détail d'articles médicaux et orthopédiques en magasin spécialisé": '47.74Z', 'Commerce de détail de parfumerie et de produits de beauté en magasin spécialisé': '47.75Z', 'Commerce de détail de fleurs, plantes, graines, engrais, animaux de compagnie et aliments pour ces animaux en magasin spécialisé': '47.76Z', "Commerce de détail d'articles d'horlogerie et de bijouterie en magasin spécialisé": '47.77Z', 'Autre commerce de détail de biens neufs en magasin spécialisé': '47.78', "Commerces de détail d'optique": '47.78A', 'Commerces de détail de charbons et combustibles': '47.78B', 'Autres commerces de détail spécialisés divers': '47.78C', "Commerce de détail de biens d'occasion en magasin": '47.79Z', 'Commerce de détail sur éventaires et marchés': '47.8', 'Commerce de détail alimentaire sur éventaires et marchés': '47.81Z', "Commerce de détail de textiles, d'habillement et de chaussures sur éventaires et marchés": '47.82Z', 'Autres commerces de détail sur éventaires et marchés': '47.89Z', 'Commerce de détail hors magasin, éventaires ou marchés': '47.9', 'Vente à distance': '47.91', 'Vente à distance sur catalogue général': '47.91A', 'Vente à distance sur catalogue spécialisé': '47.91B', 'Autres commerces de détail hors magasin, éventaires ou marchés': '47.99', 'Vente à domicile': '47.99A', 'Vente par automates et autres commerces de détail hors magasin, éventaires ou marchés n.c.a.': '47.99B', 'Transports terrestres et transport par conduites': '49', 'Transport ferroviaire interurbain de voyageurs': '49.10Z', 'Transports ferroviaires de fret': '49.2', 'Transports ferroviaires de fret ': '49.20Z', 'Autres transports terrestres de voyageurs': '49.3', 'Transports urbains et suburbains de voyageurs': '49.31Z', 'Transports de voyageurs par taxis': '49.32Z', 'Autres transports terrestres de voyageurs n.c.a.': '49.39', 'Transports routiers réguliers de voyageurs': '49.39A', 'Autres transports routiers de voyageurs ': '49.39B', 'Téléphériques et remontées mécaniques': '49.39C', 'Transports routiers de fret et services de déménagement': '49.4', 'Transports routiers de fret': '49.41', 'Transports routiers de fret interurbains': '49.41A', 'Transports routiers de fret de proximité': '49.41B', 'Location de camions avec chauffeur': '49.41C', 'Services de déménagement': '49.42Z', 'Transports par conduites': '49.50Z', 'Transports par eau': '50', 'Transports maritimes et côtiers de passagers': '50.10Z', 'Transports maritimes et côtiers de fret': '50.20Z', 'Transports fluviaux de passagers': '50.30Z', 'Transports fluviaux de fret': '50.4', 'Transports fluviaux de fret ': '50.40Z', 'Transports aériens': '51', 'Transports aériens de passagers': '51.10Z', 'Transports aériens de fret et transports spatiaux': '51.2', 'Transports aériens de fret': '51.21Z', 'Transports spatiaux': '51.22Z', 'Entreposage et services auxiliaires des transports': '52', 'Entreposage et stockage': '52.10', 'Entreposage et stockage frigorifique': '52.10A', 'Entreposage et stockage non frigorifique': '52.10B', 'Services auxiliaires des transports': '52.2', 'Services auxiliaires des transports terrestres': '52.21Z', 'Services auxiliaires des transports par eau': '52.22Z', 'Services auxiliaires des transports aériens': '52.23Z', 'Manutention': '52.24', 'Manutention portuaire': '52.24A', 'Manutention non portuaire': '52.24B', 'Autres services auxiliaires des transports ': '52.29', 'Messagerie, fret express': '52.29A', 'Affrètement et organisation des transports ': '52.29B', 'Activités de poste et de courrier': '53', "Activités de poste dans le cadre d'une obligation de service universel": '53.1', "Activités de poste dans le cadre d'une obligation de service universel ": '53.10Z', 'Autres activités de poste et de courrier': '53.20Z', 'Hébergement': '55', 'Hôtels et hébergement similaire': '55.1', 'Hôtels et hébergement similaire ': '55.10Z', 'Hébergement touristique et autre hébergement de courte durée ': '55.20Z', 'Terrains de camping et parcs pour caravanes ou véhicules de loisirs': '55.30Z', 'Autres hébergements ': '55.90Z', 'Restauration': '56', 'Restaurants et services de restauration mobile': '56.10', 'Restauration traditionnelle': '56.10A', 'Cafétérias et autres libres-services': '56.10B', 'Restauration de type rapide': '56.10C', 'Traiteurs et autres services de restauration': '56.2', 'Services des traiteurs ': '56.21Z', 'Autres services de restauration ': '56.29', 'Restauration collective sous contrat': '56.29A', 'Autres services de restauration n.c.a.': '56.29B', 'Débits de boissons': '56.30Z', 'Édition': '58', "Édition de livres et périodiques et autres activités d'édition ": '58.1', 'Édition de livres': '58.11Z', "Édition de répertoires et de fichiers d'adresses": '58.12Z', 'Édition de journaux': '58.13Z', 'Édition de revues et périodiques': '58.14Z', "Autres activités d'édition": '58.19Z', 'Édition de logiciels': '58.2', 'Édition de jeux électroniques': '58.21Z', "Édition d'autres logiciels": '58.29', 'Édition de logiciels système et de réseau': '58.29A', 'Edition de logiciels outils de développement et de langages': '58.29B', 'Edition de logiciels applicatifs': '58.29C', 'Production de films cinématographiques, de vidéo et de programmes de télévision ; enregistrement sonore et édition musicale': '59', 'Activités cinématographiques, vidéo et de télévision': '59.1', 'Production de films cinématographiques, de vidéo et de programmes de télévision ': '59.11', 'Production de films et de programmes pour la télévision ': '59.11A', 'Production de films institutionnels et publicitaires': '59.11B', 'Production de films pour le cinéma': '59.11C', 'Post-production de films cinématographiques, de vidéo et de programmes de télévision': '59.12Z', 'Distribution de films cinématographiques, de vidéo et de programmes de télévision ': '59.13', 'Distribution de films cinématographiques': '59.13A', 'Edition et distribution vidéo': '59.13B', 'Projection de films cinématographiques': '59.14Z', 'Enregistrement sonore et édition musicale': '59.2', 'Enregistrement sonore et édition musicale ': '59.20Z', 'Programmation et diffusion': '60', 'Édition et diffusion de programmes radio': '60.10Z', 'Programmation de télévision et télédiffusion': '60.20', 'Edition de chaînes généralistes': '60.20A', 'Edition de chaînes thématiques': '60.20B', 'Télécommunications': '61', 'Télécommunications filaires': '61.10Z', 'Télécommunications sans fil ': '61.20Z', 'Télécommunications par satellite': '61.30Z', 'Autres activités de télécommunication': '61.9', 'Autres activités de télécommunication ': '61.90Z', 'Programmation, conseil et autres activités informatiques ': '62.0', 'Programmation informatique': '62.01Z', 'Conseil informatique ': '62.02', 'Conseil en systèmes et logiciels informatiques': '62.02A', 'Tierce maintenance de systèmes et d’applications informatiques': '62.02B', "Gestion d'installations informatiques": '62.03Z', 'Autres activités informatiques': '62.09Z', "Services d'information": '63', 'Traitement de données, hébergement et activités connexes ; portails Internet': '63.1', 'Traitement de données, hébergement et activités connexes': '63.11Z', 'Portails Internet': '63.12Z', "Autres services d'information": '63.9', 'Activités des agences de presse': '63.91Z', "Autres services d'information n.c.a.": '63.99Z', 'Activités des services financiers, hors assurance et caisses de retraite': '64', 'Intermédiation monétaire': '64.1', 'Activités de banque centrale': '64.11Z', 'Autres intermédiations monétaires': '64.19Z', 'Activités des sociétés holding': '64.20Z', 'Fonds de placement et entités financières similaires': '64.30Z', 'Autres activités des services financiers, hors assurance et caisses de retraite': '64.9', 'Crédit-bail ': '64.91Z', 'Autre distribution de crédit': '64.92Z', 'Autres activités des services financiers, hors assurance et caisses de retraite, n.c.a.': '64.99Z', 'Assurance': '65.1', 'Assurance vie ': '65.11', 'Assurance vie': '65.11Z', 'Autres assurances': '65.12Z', 'Réassurance': '65.20Z', 'Caisses de retraite': '65.30Z', "Activités auxiliaires de services financiers et d'assurance ": '66', 'Activités auxiliaires de services financiers, hors assurance et caisses de retraite': '66.1', 'Administration de marchés financiers': '66.11Z', 'Courtage de valeurs mobilières et de marchandises': '66.12Z', 'Autres activités auxiliaires de services financiers, hors assurance et caisses de retraite': '66.19', 'Supports juridiques de gestion de patrimoine mobilier': '66.19A', 'Autres activités auxiliaires de services financiers, hors assurance et caisses de retraite, n.c.a.': '66.19B', "Activités auxiliaires d'assurance et de caisses de retraite": '66.2', 'Évaluation des risques et dommages': '66.21Z', "Activités des agents et courtiers d'assurances": '66.22Z', "Autres activités auxiliaires d'assurance et de caisses de retraite": '66.29Z', 'Gestion de fonds': '66.30Z', 'Activités immobilières': '68', 'Activités des marchands de biens immobiliers': '68.10Z', 'Location et exploitation de biens immobiliers propres ou loués': '68.2', 'Location et exploitation de biens immobiliers propres ou loués ': '68.20', 'Location de logements': '68.20A', "Location de terrains et d'autres biens immobiliers": '68.20B', 'Activités immobilières pour compte de tiers': '68.3', 'Agences immobilières': '68.31Z', 'Administration de biens immobiliers': '68.32', "Administration d'immeubles et autres biens immobiliers": '68.32A', 'Supports juridiques de gestion de patrimoine immobilier': '68.32B', 'Activités juridiques et comptables': '69', 'Activités juridiques': '69.10Z', 'Activités comptables': '69.20Z', 'Activités des sièges sociaux ; conseil de gestion': '70', 'Activités des sièges sociaux': '70.10Z', 'Conseil de gestion': '70.2', 'Conseil en relations publiques et communication': '70.21Z', 'Conseil pour les affaires et autres conseils de gestion': '70.22Z', "Activités d'architecture et d'ingénierie ; activités de contrôle et analyses techniques": '71', "Activités d'architecture et d'ingénierie": '71.1', "Activités d'architecture ": '71.11Z', "Activités d'ingénierie": '71.12', 'Activité des géomètres': '71.12A', 'Ingénierie, études techniques': '71.12B', 'Activités de contrôle et analyses techniques': '71.20', 'Contrôle technique automobile': '71.20A', 'Analyses, essais et inspections techniques': '71.20B', 'Recherche-développement scientifique': '72', 'Recherche-développement en sciences physiques et naturelles': '72.1', 'Recherche-développement en biotechnologie': '72.11Z', 'Recherche-développement en autres sciences physiques et naturelles': '72.19Z', 'Recherche-développement en sciences humaines et sociales': '72.20Z', 'Publicité et études de marché': '73', 'Publicité': '73.1', 'Activités des agences de publicité': '73.11Z', 'Régie publicitaire de médias': '73.12Z', 'Études de marché et sondages': '73.20Z', 'Autres activités spécialisées, scientifiques et techniques': '74', 'Activités spécialisées de design': '74.10Z', 'Activités photographiques': '74.20Z', 'Traduction et interprétation': '74.30Z', 'Autres activités spécialisées, scientifiques et techniques n.c.a.': '74.90', 'Activité des économistes de la construction': '74.90A', 'Activités spécialisées, scientifiques et techniques diverses': '74.90B', 'Activités vétérinaires': '75.00Z', 'Activités de location et location-bail': '77', 'Location et location-bail de véhicules automobiles': '77.1', 'Location et location-bail de voitures et de véhicules automobiles légers': '77.11', 'Location de courte durée de voitures et de véhicules automobiles légers': '77.11A', 'Location de longue durée de voitures et de véhicules automobiles légers': '77.11B', 'Location et location-bail de camions': '77.12Z', 'Location et location-bail de biens personnels et domestiques': '77.2', "Location et location-bail d'articles de loisirs et de sport ": '77.21Z', 'Location de vidéocassettes et disques vidéo': '77.22Z', "Location et location-bail d'autres biens personnels et domestiques": '77.29Z', "Location et location-bail d'autres machines, équipements et biens": '77.3', 'Location et location-bail de machines et équipements agricoles': '77.31Z', 'Location et location-bail de machines et équipements pour la construction': '77.32Z', 'Location et location-bail de machines de bureau et de matériel informatique': '77.33Z', 'Location et location-bail de matériels de transport par eau': '77.34Z', 'Location et location-bail de matériels de transport aérien': '77.35Z', "Location et location-bail d'autres machines, équipements et biens matériels n.c.a. ": '77.39Z', "Location-bail de propriété intellectuelle et de produits similaires, à l'exception des œuvres soumises à copyright": '77.40Z', "Activités liées à l'emploi": '78', "Activités des agences de placement de main-d'œuvre": '78.1', "Activités des agences de placement de main-d'œuvre ": '78.10Z', 'Activités des agences de travail temporaire': '78.2', 'Activités des agences de travail temporaire ': '78.20Z', 'Autre mise à disposition de ressources humaines': '78.30Z', 'Activités des agences de voyage, voyagistes, services de réservation et activités connexes': '79', 'Activités des agences de voyage et voyagistes': '79.1', 'Activités des agences de voyage': '79.11Z', 'Activités des voyagistes': '79.12Z', 'Autres services de réservation et activités connexes': '79.90Z', 'Enquêtes et sécurité': '80', 'Activités de sécurité privée': '80.1', 'Activités de sécurité privée ': '80.10Z', 'Activités liées aux systèmes de sécurité': '80.2', 'Activités liées aux systèmes de sécurité ': '80.20Z', "Activités d'enquête": '80.30Z', 'Services relatifs aux bâtiments et aménagement paysager': '81', 'Activités combinées de soutien lié aux bâtiments': '81.1', 'Activités combinées de soutien lié aux bâtiments ': '81.10Z', 'Activités de nettoyage': '81.2', 'Nettoyage courant des bâtiments': '81.21Z', 'Autres activités de nettoyage des bâtiments et nettoyage industriel': '81.22Z', 'Autres activités de nettoyage': '81.29', 'Désinfection, désinsectisation, dératisation': '81.29A', 'Autres activités de nettoyage n.c.a.': '81.29B', "Services d'aménagement paysager": '81.3', "Services d'aménagement paysager ": '81.30Z', 'Activités administratives et autres activités de soutien aux entreprises': '82', 'Activités administratives ': '82.1', 'Services administratifs combinés de bureau': '82.11Z', 'Photocopie, préparation de documents et autres activités spécialisées de soutien de bureau': '82.19Z', "Activités de centres d'appels": '82.20Z', 'Organisation de salons professionnels et congrès': '82.30', 'Organisation de foires, salons professionnels et congrès': '82.30Z', 'Activités de soutien aux entreprises n.c.a.': '82.9', "Activités des agences de recouvrement de factures et des sociétés d'information financière sur la clientèle": '82.91Z', 'Activités de conditionnement': '82.92Z', 'Autres activités de soutien aux entreprises n.c.a.': '82.99Z', 'Administration publique et défense ; sécurité sociale obligatoire': '84', 'Administration générale, économique et sociale': '84.1', 'Administration publique générale': '84.11Z', 'Administration publique (tutelle) de la santé, de la formation, de la culture et des services sociaux, autre que sécurité sociale ': '84.12Z', 'Administration publique (tutelle) des activités économiques': '84.13Z', 'Services de prérogative publique': '84.2', 'Affaires étrangères': '84.21Z', 'Défense': '84.22Z', 'Justice': '84.23Z', 'Activités d’ordre public et de sécurité': '84.24Z', 'Services du feu et de secours': '84.25Z', 'Sécurité sociale obligatoire': '84.30', 'Activités générales de sécurité sociale': '84.30A', 'Gestion des retraites complémentaires': '84.30B', 'Distribution sociale de revenus': '84.30C', 'Enseignement': '85', 'Enseignement pré-primaire': '85.10Z', 'Enseignement primaire': '85.20Z', 'Enseignement secondaire': '85.3', 'Enseignement secondaire général': '85.31Z', 'Enseignement secondaire technique ou professionnel': '85.32Z', 'Enseignement supérieur et post-secondaire non supérieur': '85.4', 'Enseignement post-secondaire non supérieur': '85.41Z', 'Enseignement supérieur': '85.42Z', "Autres activités d'enseignement": '85.5', "Enseignement de disciplines sportives et d'activités de loisirs": '85.51Z', 'Enseignement culturel': '85.52Z', 'Enseignement de la conduite': '85.53Z', 'Enseignements divers': '85.59', "Formation continue d'adultes": '85.59A', 'Autres enseignements': '85.59B', "Activités de soutien à l'enseignement": '85.60Z', 'Activités pour la santé humaine': '86', 'Activités hospitalières': '86.10Z', 'Activité des médecins et des dentistes': '86.2', 'Activité des médecins généralistes': '86.21Z', 'Activité des médecins spécialistes': '86.22', 'Activités de radiodiagnostic et de radiothérapie': '86.22A', 'Activités chirurgicales': '86.22B', 'Autres activités des médecins spécialistes': '86.22C', 'Pratique dentaire': '86.23Z', 'Autres activités pour la santé humaine': '86.90', 'Ambulances': '86.90A', "Laboratoires d'analyses médicales": '86.90B', "Centres de collecte et banques d'organes": '86.90C', 'Activités des infirmiers et des sages-femmes': '86.90D', 'Activités des professionnels de la rééducation, de l’appareillage et des pédicures-podologues': '86.90E', 'Activités de santé humaine non classées ailleurs': '86.90F', 'Hébergement médico-social et social': '87', 'Hébergement médicalisé': '87.10', 'Hébergement médicalisé pour personnes âgées': '87.10A', 'Hébergement médicalisé pour enfants handicapés ': '87.10B', 'Hébergement médicalisé pour adultes handicapés et autre hébergement médicalisé \n': '87.10C', 'Hébergement social pour personnes handicapées mentales, malades mentales et toxicomanes': '87.20', 'Hébergement social pour handicapés mentaux et malades mentaux ': '87.20A', 'Hébergement social pour toxicomanes': '87.20B', 'Hébergement social pour personnes âgées ou handicapées physiques ': '87.30', 'Hébergement social pour personnes âgées': '87.30A', 'Hébergement social pour handicapés  physiques': '87.30B', 'Autres activités d’hébergement social ': '87.90', 'Hébergement social pour enfants en difficultés ': '87.90A', 'Hébergement social pour adultes et familles en difficultés et autre hébergement social ': '87.90B', 'Action sociale sans hébergement': '88', 'Action sociale sans hébergement pour personnes âgées et pour personnes handicapées ': '88.10', 'Aide à domicile  ': '88.10A', 'Accueil ou accompagnement sans hébergement d’adultes handicapés ou de  personnes âgées': '88.10B', 'Aide par le travail ': '88.10C', 'Autre action sociale sans hébergement': '88.9', 'Action sociale sans hébergement pour jeunes enfants': '88.91', 'Accueil de jeunes enfants': '88.91A', 'Accueil ou accompagnement sans hébergement d’enfants handicapés': '88.91B', 'Autre action sociale sans hébergement n.c.a.': '88.99', 'Autre accueil ou accompagnement sans hébergement d’enfants\n et d’adolescents\n': '88.99A', 'Action sociale sans hébergement n.c.a.': '88.99B', 'Activités créatives, artistiques et de spectacle ': '90.0', 'Arts du spectacle vivant': '90.01Z', 'Activités de soutien au spectacle vivant': '90.02Z', 'Création artistique': '90.03', 'Création artistique relevant des arts plastiques': '90.03A', 'Autre création artistique': '90.03B', 'Gestion de salles de spectacles': '90.04Z', 'Bibliothèques, archives, musées et autres activités culturelles': '91.0', 'Gestion des bibliothèques et des archives': '91.01Z', 'Gestion des musées': '91.02Z', 'Gestion des sites et monuments historiques et des attractions touristiques similaires': '91.03Z', 'Gestion des jardins botaniques et zoologiques et des réserves naturelles': '91.04Z', "Organisation de jeux de hasard et d'argent": '92.00Z', 'Activités sportives, récréatives et de loisirs': '93', 'Activités liées au sport': '93.1', "Gestion d'installations sportives": '93.11Z', 'Activités de clubs de sports': '93.12Z', 'Activités des centres de culture physique': '93.13Z', 'Autres activités liées au sport': '93.19Z', 'Activités récréatives et de loisirs': '93.2', "Activités des parcs d'attractions et parcs à thèmes": '93.21Z', 'Autres activités récréatives et de loisirs ': '93.29', 'Autres activités récréatives et de loisirs': '93.29Z', 'Activités des organisations associatives': '94', 'Activités des organisations économiques, patronales et professionnelles': '94.1', 'Activités des organisations patronales et consulaires': '94.11Z', 'Activités des organisations professionnelles': '94.12Z', 'Activités des syndicats de salariés': '94.20Z', 'Activités des autres organisations associatives': '94.9', 'Activités des organisations religieuses': '94.91Z', 'Activités des organisations politiques': '94.92Z', 'Activités des organisations associatives n.c.a.': '94.99', 'Autres organisations fonctionnant par adhésion volontaire': '94.99Z', "Réparation d'ordinateurs et de biens personnels et domestiques": '95', "Réparation d'ordinateurs et d'équipements de communication ": '95.1', "Réparation d'ordinateurs et d'équipements périphériques": '95.11Z', "Réparation d'équipements de communication": '95.12Z', 'Réparation de biens personnels et domestiques': '95.2', 'Réparation de produits électroniques grand public': '95.21Z', "Réparation d'appareils électroménagers et d'équipements pour la maison et le jardin": '95.22Z', "Réparation de chaussures et d'articles en cuir": '95.23Z', "Réparation de meubles et d'équipements du foyer": '95.24Z', "Réparation d'articles d'horlogerie et de bijouterie": '95.25Z', "Réparation d'autres biens personnels et domestiques": '95.29Z', 'Autres services personnels': '96.0', 'Blanchisserie-teinturerie': '96.01', 'Blanchisserie-teinturerie de gros': '96.01A', 'Blanchisserie-teinturerie de détail': '96.01B', 'Coiffure et soins de beauté': '96.02', 'Coiffure': '96.02A', 'Soins de beauté': '96.02B', 'Services funéraires': '96.03Z', 'Entretien corporel': '96.04Z', 'Autres services personnels n.c.a.': '96.09Z', "Activités des ménages en tant qu'employeurs de personnel domestique": '97.00Z', 'Activités indifférenciées des ménages en tant que producteurs de biens et services pour usage propre': '98', 'Activités indifférenciées des ménages en tant que producteurs de biens pour usage propre': '98.10Z', 'Activités indifférenciées des ménages en tant que producteurs de services pour usage propre': '98.20Z', 'Activités des organisations et organismes extraterritoriaux': '99.00Z'}
    del test['header']
    x=[]
    for i in range(0,len(test['unitesLegales'])-1):
        value=[]
        if 'dateFin' in test['unitesLegales'][i]['periodesUniteLegale'][0]:
            test['unitesLegales'][i]['periodesUniteLegale'][0].pop('dateFin')    
        for valeur in test['unitesLegales'][i].values():  
            if valeur==test['unitesLegales'][i]['periodesUniteLegale']:
                for valeur1 in test['unitesLegales'][i]['periodesUniteLegale'][0].values():
                    value=value+[valeur1]
            else:
                value=value+[valeur]
        for element in value:
            if element=='None':
                del value
        x=x+[value]
    
    for key  in test['unitesLegales'][0]:
        cles= cles+[key]
    for key in test['unitesLegales'][0]['periodesUniteLegale'][0]:
        cles= cles+[key]
    cles.remove('periodesUniteLegale')
    i=2
    data=[]
    for element in x:
        if element[1]!='[ND]'and len(element)==6 :
            data=data+[element]     
    for element in data:
        for value in unité.values():
            if element[4]==value:                    
                element[4]=get_key(value,unité)
                idx2 = cles.index('dateDebut')
                idx3 = cles.index('prenomUsuelUniteLegale')
                element[idx3], element[idx2] = element[idx2], element[idx3]
    idx2 = cles.index('dateDebut')
    idx3 = cles.index('prenomUsuelUniteLegale')
    cles[idx3], cles[idx2] = cles[idx2], cles[idx3] 
    donnée_adresse=[]
    for donnéev3 in data:
        adresse_etab=info_etablissement(donnéev3,TOKEN)
        donnée=donnéev3+adresse_etab
        donnée_adresse=donnée_adresse+[donnée]
    return donnée_adresse, cles
    
def info_etablissement(element,TOKEN):
    headers={"Authorization":"Bearer "+TOKEN}
    h="" 
    h=element[0]+element[5]
    url="https://api.insee.fr/entreprises/sirene/V3/siret/"+h
    response=requests.get(url,headers=headers)
    info_etab = response.json()
    del info_etab['header']
    numVoie=str(info_etab['etablissement']['adresseEtablissement']['numeroVoieEtablissement'])
    typeVoie=str(info_etab['etablissement']['adresseEtablissement']['typeVoieEtablissement'])
    libelleVoie=str(info_etab['etablissement']['adresseEtablissement']['libelleVoieEtablissement'])
    libelleCommune=str(info_etab['etablissement']['adresseEtablissement']['libelleCommuneEtablissement'])
    code_postal=str(info_etab['etablissement']['adresseEtablissement']['codePostalEtablissement'])
    if (numVoie=="None" or typeVoie=="None" or libelleVoie=="None" or libelleCommune=="None" or code_postal=="None"):
        adresse=[None]
    else:
        position=numVoie+" "+typeVoie+" "+libelleVoie
        commune=libelleCommune
        CP=code_postal
        adresse=[position,commune,CP]
    return adresse

    
def enregistrement(x):
    date = datetime.datetime.now()
    tim=date.strftime("%Y-%m-%d")
    filename="/home/ziyad/projet_informatique/AutomatisationMail/resultat/"+tim +".csv"
    if os.path.exists(filename):
        os.remove(filename)        
    f=open(filename, 'a',newline='')
    writer = csv.writer(f)
    file_size = os.path.getsize(filename)
    if (file_size<100):
        writer.writerow(x[1][0:5]+['Adresse','Commune','CodePostal'])
        for i in range(len(x[0])):
            if (x[0][i][6]!=None):
                writer.writerow(x[0][i][0:5]+x[0][i][-3:])
    
    return

def envoyer_mail():
    date = datetime.datetime.now()
    tim=date.strftime("%Y-%m-%d")
    filename="/home/ziyad/projet_informatique/AutomatisationMail/resultat/"+tim +".csv"
    smtp_server = "smtp.gmail.com"
    smtp_port = 587
    expediteur = "devfbweb23@gmail.com"
    mot_de_passe = "trlpfychbmbfaibm"

    destinataire = "amzilziyad10@gmail.com"

    msg = MIMEMultipart()
    msg['From'] = expediteur
    msg['To'] = destinataire
    msg['Subject'] = "Extraction du "+tim

    message = "Bonjour,\nVoici le fichier de porspection du "+tim+" ci joint: \nBien à toi\nZiyad AMZIL"
    msg.attach(MIMEText(message))

    nom_fichier = "/home/ziyad/projet_informatique/AutomatisationMail/resultat/2023-04-09.csv"
    piece_jointe = open(nom_fichier, "rb")
    part = MIMEBase('application', 'octet-stream')
    part.set_payload((piece_jointe).read())
    encoders.encode_base64(part)
    part.add_header('Content-Disposition', "attachment; filename= %s" % "ficier_prospection")
    msg.attach(part)

    serveur_smtp = smtplib.SMTP(smtp_server, smtp_port)
    serveur_smtp.starttls()
    serveur_smtp.login(expediteur, mot_de_passe)
    serveur_smtp.sendmail(expediteur, destinataire, msg.as_string())
    serveur_smtp.quit()
    return

def main():
    while(True):
        date = str(datetime.datetime.now())
        print(date[11:16])
        if(date[11:16]=="23:58"):
            oldtoken=cletoken()
            TOKEN=remove_old_token(oldtoken)
            databrute=utilisation_donnees(TOKEN[0])
            data_traites=traitement_données(databrute,TOKEN[0])
            enregistrement(data_traites)
            envoyer_mail()
    return
main()